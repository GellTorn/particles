var W=Object.defineProperty;var E=(c,t,i)=>t in c?W(c,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[t]=i;var C=(c,t,i)=>(E(c,typeof t!="symbol"?t+"":t,i),i);var x=class{constructor(t=0,i=0){this.x=t,this.y=i}static fromVector(t){return new x(t.x,t.y)}static fromArray(t){return new x(t[0],t[1])}set(t,i=t){return this.x=t,this.y=i,this}setToPolar(t,i=1){return this.x=Math.cos(t)*i,this.y=Math.sin(t)*i,this}equals(t){return this.x===t.x&&this.y===t.y}angle(){let t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}setAngle(t){return this.setToPolar(t,this.length())}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}divide(t){return this.x/=t.x,this.y/=t.y,this}scale(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this}negate(){return this.x=-this.x,this.y=-this.y,this}distance(t){let i=t.x-this.x,e=t.y-this.y;return Math.sqrt(i*i+e*e)}distanceSq(t){let i=t.x-this.x,e=t.y-this.y;return i*i+e*e}length(){let t=this.x,i=this.y;return Math.sqrt(t*t+i*i)}setLength(t){return this.normalize().scale(t)}lengthSq(){let t=this.x,i=this.y;return t*t+i*i}normalize(){let t=this.x,i=this.y,e=t*t+i*i;return e>0&&(e=1/Math.sqrt(e),this.x=t*e,this.y=i*e),this}normalizeRightHand(){let t=this.x;return this.x=this.y*-1,this.y=t,this}normalizeLeftHand(){let t=this.x;return this.x=this.y,this.y=t*-1,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lerp(t,i=0){let e=this.x,s=this.y;return this.x=e+i*(t.x-e),this.y=s+i*(t.y-s),this}reset(){return this.x=0,this.y=0,this}limit(t){let i=this.length();return i&&i>t&&this.scale(t/i),this}reflect(t){return t=x.fromVector(t).normalize(),this.subtract(t.scale(2*this.dot(t)))}mirror(t){return this.reflect(t).negate()}rotate(t){let i=Math.cos(t),e=Math.sin(t);return this.set(i*this.x-e*this.y,e*this.x+i*this.y)}toPolar(){return{p:Math.sqrt(this.x*this.x+this.y*this.y),q:Math.atan2(this.y,this.x)}}},o=x;var T=class{constructor(t=0,i=0,e=0){this.position=new o(t,i),this.radius=e}get center(){return this.position}set center(t){this.position=t}get diameter(){return this.radius*2}set diameter(t){this.radius=t*.5}get left(){return this.position.x-this.radius}set left(t){this.position.x=t+this.radius}get right(){return this.position.x+this.radius}set right(t){this.position.x=t-this.radius}get top(){return this.position.y+this.radius}set top(t){this.position.y=t-this.radius}get bottom(){return this.position.y-this.radius}set bottom(t){this.position.y=t+this.radius}intersectsPoint(t){return t.distance(this.position)<=this.radius}},w=T;var R=class{constructor(t=new o,i=new o){this.a=t,this.b=i}length(){return Math.sqrt((this.b.x-this.a.x)*(this.b.x-this.a.x)+(this.b.y-this.a.y)*(this.b.y-this.a.y))}},g=R;var b=class{constructor(){this.position=new o,this.velocity=new o,this.active=!0,this.radius=1}update(){this.position.add(this.velocity)}},z=class{constructor(){this.particles=[]}createParticle(){let t=new b;return this.particles.push(t),t}};var V=class{constructor(t=0,i=0,e=0,s=0){this.position=new o(t,i),this.size=new o(e,s)}get left(){return this.position.x}set left(t){t>=this.right?this.size.x=0:this.size.x=this.right-t,this.position.x=t}get right(){return this.position.x+this.size.x}set right(t){t<=this.position.x?this.size.x=0:this.size.x=t-this.position.x}get top(){return this.position.y}set top(t){t>=this.bottom?this.size.y=0:this.size.y=this.bottom-t,this.position.y=t}get bottom(){return this.position.y+this.size.y}set bottom(t){t<=this.position.y?this.size.y=0:this.size.y=t-this.position.y}get center(){return new o(this.position.x+this.size.x/2,this.position.y+this.size.y/2)}set center({x:t,y:i}){this.x=t-this.size.x/2,this.y=i-this.size.y/2}set(t,i,e,s){this.position.set(t,i),this.size.set(e,s)}contains(t){return t.x>=this.left&&t.x<=this.right&&t.y>=this.top&&t.y<=this.bottom}intersectsCircle(t){return!(t.position.x+t.radius<=this.left&&t.position.x+t.radius>=this.right&&t.position.y+t.radius<=this.top&&t.position.y+t.radius>=this.bottom)}intersectsRectangle(t){return!(Math.abs(this.position.x-t.position.x)>this.size.x/2+t.size.x/2||Math.abs(this.position.y-t.position.y)>this.size.y/2+t.size.y/2)}},f=V;var P=class{constructor(t,i="#000",e=new o(300,150),s=1){this.objectToRender=[],this.deltas=[],this.gradient=null,this.dpiMultiplier=s,this.ctx=t,this.debug=!1,this.viewportSize=e,this.transparentBackground=!0,this.backgroundColor=i}render(){this.drawBackground(this.ctx,this.viewportSize,this.transparentBackground,this.gradient,this.dpiMultiplier);let t=this.objectToRender.filter(r=>r instanceof b),i=this.objectToRender.filter(r=>r instanceof g),e=this.objectToRender.filter(r=>r instanceof f),s=this.objectToRender.filter(r=>r instanceof w);this.drawParticles(this.ctx,t,this.dpiMultiplier),this.drawLines(this.ctx,i,this.dpiMultiplier),this.drawRectangles(this.ctx,e,this.dpiMultiplier),this.drawCircles(this.ctx,s,this.dpiMultiplier),this.debug&&this.drawPerformanceGraphic(this.ctx,this.deltas,this.dpiMultiplier)}drawBackground(t,i,e,s,r){e?t.clearRect(0,0,i.x*r,i.y*r):s?(t.fillStyle=s,t.fillRect(0,0,i.x*r,i.y*r)):(t.fillStyle=this.backgroundColor,t.fillRect(0,0,i.x*r,i.y*r))}drawParticles(t,i,e){t.fillStyle="rgba(255,255,255,0.5)",t.beginPath();for(let s of i)t.moveTo(s.position.x*e,s.position.y*e),t.arc(s.position.x*e,s.position.y*e,s.radius*e,0,Math.PI*2);t.fill()}drawLines(t,i,e){t.lineWidth=1*e;for(let s of i)t.strokeStyle=`rgba(255,255,255,${s.alpha})`,t.beginPath(),t.moveTo(s.a.x*e,s.a.y*e),t.lineTo(s.b.x*e,s.b.y*e),t.stroke()}drawRectangles(t,i){t.lineWidth=.2,t.strokeStyle="rgba(255,255,255,1)",t.beginPath();for(let e of i)t.rect(e.position.x,e.position.y,e.size.x,e.size.y);t.stroke()}drawCircles(t,i,e){t.lineWidth=.2,t.strokeStyle="rgba(255,255,255,0.5)",t.beginPath();for(let s of i)t.moveTo(s.position.x+s.radius*e,s.position.y*e),t.arc(s.position.x*e,s.position.y*e,s.radius*e,0,Math.PI*2);t.stroke()}drawPerformanceGraphic(t,i,e){var p;let s=(u,y,L)=>(u-y)/(L-y),r=i.filter(u=>Boolean(u)),n=Math.min(...r),h=Math.max(...r);t.lineWidth=1,t.font=`${16*e}px monospace`,t.strokeStyle="#fff",t.fillStyle="#fff";let a=0,l=70;t.beginPath(),t.moveTo(a*e,(l-i[0])*e);for(let u of i){let y=l-50*s(u,n,h);t.lineTo(a*e,y*e),a+=2}t.moveTo(0,l*e),t.lineTo(i.length*2*e,l*e),t.fillText(n,i.length*2*e,(l+4)*e),t.moveTo(0,(l-50)*e),t.lineTo(i.length*2*e,(l-50)*e),t.fillText(h,i.length*2*e,(l-50+4)*e),t.closePath(),t.stroke(),t.fillText(`${this.objectToRender.length.toString()} objects`,0,15*e),t.fillText(`${(p=i[i.length-1])==null?void 0:p.toString()} ms`,150*e,15*e)}},v=P;var m=class{constructor(t,i){this.rectangle=t,this.capacity=i,this.points=[],this.divided=!1,this.northEast,this.northWest,this.southEast,this.southWest}subdivide(){let t=this.rectangle.position.x,i=this.rectangle.position.y,e=this.rectangle.size.x,s=this.rectangle.size.y,r=this.capacity;this.northEast=new m(new f(t,i,e/2,s/2),r),this.northWest=new m(new f(t+e/2,i,e/2,s/2),r),this.southEast=new m(new f(t,i+s/2,e/2,s/2),r),this.southWest=new m(new f(t+e/2,i+s/2,e/2,s/2),r),this.divided=!0}insert(t){var i;return this.rectangle.contains(t.position)?this.points.length<this.capacity?(this.points.push(t),!0):(this.divided||this.subdivide(),(i=this.northEast.insert(t)||this.northWest.insert(t)||this.southEast.insert(t)||this.southWest.insert(t))!=null?i:!1):!1}queryCircle(t){let i=[],e=[];e.push(this);for(let s=0;s<e.length;s++){let r=e[s];if(r.rectangle.intersectsCircle(t)){for(let n of r.points)t.intersectsPoint(n.position)&&i.push(n);r.divided&&(e.push(r.northEast),e.push(r.northWest),e.push(r.southEast),e.push(r.southWest))}}return i}getAllRectangles(){let t=[];t.push(this);for(let i=0;i<t.length;i++){let e=t[i];e.divided&&(t.push(e.northEast),t.push(e.northWest),t.push(e.southEast),t.push(e.southWest))}return t.map(i=>i.rectangle)}},k=m;var j=class{static intBetween(t,i){return i||(i=t,t=0),Math.floor(Math.random()*(i-t)+t)}static floatBetween(t,i){return i||(i=t,t=0),Math.random()*(i-t)+t}static fromArray(t){return t[Math.floor(Math.random()*t.length)]}static indexFromArray(t){return Math.floor(Math.random()*t.length)}},d=j;var B=class{constructor(t=new o(1,1),i=new f(0,0,100,100)){this.rectangles=[],this.boundRectangles=[],this.size=t,this.boundRectangle=i,this.width=i.size.x/t.x,this.height=i.size.y/t.y,this.initReactangles(t,i)}initReactangles(t){for(let i=0;i<t.x;i++)for(let e=0;e<t.y;e++)this.rectangles.push(new M(i*this.width,e*this.height,this.width,this.height))}insert(t){let i=Math.floor(t.position.x/this.width),e=Math.floor(t.position.y/this.height),s=i*e,r=this.rectangles[s];r&&r.particles.push(t)}getIntersectedRectangles(t){let i=Math.floor(t.left/this.width),e=Math.ceil(t.right/this.width),s=Math.floor(t.bottom/this.height),r=Math.ceil(t.top/this.height),n=new M(i*this.width,r*this.height,(e-i)*this.width,(s-r)*this.height);this.boundRectangles.push(n);for(let h=i;h<e;h++)for(let a=s;a<r;a++){let l=this.rectangles[h*a];l&&(n.particles=[...n.particles,...l.particles])}return n}queryCircle(t){let i=[],e=this.getIntersectedRectangles(t);if(!e)return i;for(let s of e.particles)t.intersectsPoint(s.position)&&i.push(s);return i}clear(){for(let t of this.rectangles)t.particles=[];this.boundRectangles=[]}},S=B,M=class extends f{constructor(t,i,e,s,r=[]){super(t,i,e,s);this.particles=r}};var q=class{constructor(t){C(this,"oneFrame",this.update);this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.particleManager=null,this.dpiMultiplier=null,this.renderer=null,this.boundUpdate=this.update.bind(this),this.isRunning=!1,this.ticks=0,this.deltas=new Array(150),this.debug=!1,this.boundary=null,this.quadTree=null,this.grid=null,this.resizeTimeout=null,this.settings=null,this.method="default"}init(t){this.settings=t,this.particleManager=new z;for(let i=0;i<t.particles.amount;i++){let e=this.particleManager.createParticle();e.position.set(d.intBetween(-t.particles.distanceToLink,t.renderer.width+t.particles.distanceToLink),d.intBetween(-t.particles.distanceToLink,t.renderer.height+t.particles.distanceToLink));let s=new o,r=3,n=4;switch(t.particles.moveDirection){case"top":s.set(d.floatBetween(-t.particles.maxVelocity/r,t.particles.maxVelocity/r),d.floatBetween(-t.particles.maxVelocity,-t.particles.maxVelocity/n));break;case"right":s.set(d.floatBetween(t.particles.maxVelocity,t.particles.maxVelocity/n),d.floatBetween(-t.particles.maxVelocity/r,t.particles.maxVelocity/r));break;case"bottom":s.set(d.floatBetween(-t.particles.maxVelocity/r,t.particles.maxVelocity/r),d.floatBetween(t.particles.maxVelocity,t.particles.maxVelocity/n));break;case"left":s.set(d.floatBetween(-t.particles.maxVelocity,-t.particles.maxVelocity/n),d.floatBetween(-t.particles.maxVelocity/r,t.particles.maxVelocity/r));break;default:case"random":s.set(d.floatBetween(-t.particles.maxVelocity,t.particles.maxVelocity),d.floatBetween(-t.particles.maxVelocity,t.particles.maxVelocity));break}e.velocity=s,e.radius=d.floatBetween(1,t.particles.maxRadius)}if(t.staticParticles)for(let i of t.staticParticles){let e=this.particleManager.createParticle();e.active=!1,e.radius=0,e.position.set(t.renderer.width*i[0],t.renderer.height*i[1])}if(t.renderer.dpiMultiplier?this.dpiMultiplier=t.renderer.dpiMultiplier:this.dpiMultiplier=1,this.renderer=new v(this.ctx,t.renderer.backgroundColor,new o,this.dpiMultiplier),this.renderer.transparentBackground=t.renderer.transparentBackground,this.setSize(t.renderer.width,t.renderer.height),t.renderer.linearGradient){let i=this.ctx.createLinearGradient(t.renderer.width*t.renderer.linearGradient.x1*this.dpiMultiplier,t.renderer.height*t.renderer.linearGradient.y1*this.dpiMultiplier,t.renderer.width*t.renderer.linearGradient.x2*this.dpiMultiplier,t.renderer.height*t.renderer.linearGradient.y2*this.dpiMultiplier);i.addColorStop(0,t.renderer.linearGradient.color1),i.addColorStop(1,t.renderer.linearGradient.color2),this.renderer.gradient=i}return this.renderer.debug=t.debug,t.resize&&window.addEventListener("resize",this.onResize.bind(this)),this}onResize(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>this.setSize(window.innerWidth,window.innerHeight),100)}start(){return this.isRunning=!0,window.requestAnimationFrame(this.boundUpdate),console.info("Spark Partilces started!"),this}stop(){return this.isRunning=!1,this}update(){let t=Date.now();this.method==="quadTree"&&(this.quadTree=new k(this.boundary,4)),this.method==="grid"&&this.grid.clear();let i=this.particleManager.particles.filter(h=>h.active);for(let h of i)h.update(),this.checkBoundary(h,this.boundary),this.method==="quadTree"&&this.quadTree.insert(h),this.method==="grid"&&this.grid.insert(h);let e=[];this.settings.particles.linkedParticles&&(e=this.linkPartiles(this.particleManager.particles,this.settings.particles.distanceToLink));let s=[...this.particleManager.particles,...e];this.renderer.objectToRender=s,this.renderer.deltas=this.deltas,this.renderer.render(),this.isRunning&&window.requestAnimationFrame(this.boundUpdate),this.ticks++;let n=Date.now()-t;return this.deltas.push(n),this.deltas.shift(),this}linkPartiles(t,i){let e=[];if(this.method==="default")for(let s=0;s<t.length-1;s++)for(let r=s+1;r<t.length;r++){let n=t[s].position.distance(t[r].position);if(n<i){let h=new g(o.fromVector(t[s].position),o.fromVector(t[r].position)),a=1-n/i;h.alpha=a,e.push(h)}}if(this.method==="quadTree"){let s=[];for(let r of t){let n=new w(r.position.x,r.position.y,i),h=this.quadTree.queryCircle(n);s.push(r);for(let a of h){if(s.find(y=>y===a))continue;let l=r.position.distance(a.position),p=new g(o.fromVector(r.position),o.fromVector(a.position)),u=1-l/i;p.alpha=u,e.push(p)}}}if(this.method==="grid"){let s=[];for(let r of t){let n=new w(r.position.x,r.position.y,i),h=this.grid.queryCircle(n);s.push(r);for(let a of h){if(s.find(y=>y===a))continue;let l=r.position.distance(a.position),p=new g(o.fromVector(r.position),o.fromVector(a.position)),u=1-l/i;p.alpha=u,e.push(p)}}}return e}setSize(t,i){this.canvas.style.width=t.toString()+"px",this.canvas.style.height=i.toString()+"px",this.canvas.width=t*this.dpiMultiplier,this.canvas.height=i*this.dpiMultiplier,this.renderer.viewportSize=new o(t,i),this.boundary=new f(-this.settings.particles.distanceToLink,-this.settings.particles.distanceToLink,t+this.settings.particles.distanceToLink*2,i+this.settings.particles.distanceToLink*2),this.quadTree=new k(this.boundary,4);let e=Math.floor(this.boundary.size.x/this.settings.particles.distanceToLink/2.5),s=Math.floor(this.boundary.size.y/this.settings.particles.distanceToLink/2.5);return this.grid=new S(new o(e,s),this.boundary),this}checkBoundary(t,i){if(t.position.x<i.left){t.position.x=i.right;return}if(t.position.x>i.right){t.position.x=i.left;return}if(t.position.y<i.top){t.position.y=i.bottom;return}t.position.y>i.bottom&&(t.position.y=i.top)}},G=q;export{G as default};
//# sourceMappingURL=Particles.js.map

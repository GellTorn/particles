var y=Object.defineProperty,g=(t,i,e)=>(typeof i!="symbol"&&(i+=""),i in t?y(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e),u=class{constructor(t=0,i=0){this.x=t,this.y=i}static fromVector(t){return new u(t.x,t.y)}static fromArray(t){return new u(t[0],t[1])}set(t,i=t){return this.x=t,this.y=i,this}setToPolar(t,i=1){return this.x=Math.cos(t)*i,this.y=Math.sin(t)*i,this}equals(t){return this.x===t.x&&this.y===t.y}angle(){let t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}setAngle(t){return this.setToPolar(t,this.length())}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}divide(t){return this.x/=t.x,this.y/=t.y,this}scale(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this}negate(){return this.x=-this.x,this.y=-this.y,this}distance(t){let i=t.x-this.x,e=t.y-this.y;return Math.sqrt(i*i+e*e)}distanceSq(t){let i=t.x-this.x,e=t.y-this.y;return i*i+e*e}length(){let t=this.x,i=this.y;return Math.sqrt(t*t+i*i)}setLength(t){return this.normalize().scale(t)}lengthSq(){let t=this.x,i=this.y;return t*t+i*i}normalize(){let t=this.x,i=this.y,e=t*t+i*i;return e>0&&(e=1/Math.sqrt(e),this.x=t*e,this.y=i*e),this}normalizeRightHand(){let t=this.x;return this.x=this.y*-1,this.y=t,this}normalizeLeftHand(){let t=this.x;return this.x=this.y,this.y=t*-1,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lerp(t,i=0){let e=this.x,s=this.y;return this.x=e+i*(t.x-e),this.y=s+i*(t.y-s),this}reset(){return this.x=0,this.y=0,this}limit(t){let i=this.length();return i&&i>t&&this.scale(t/i),this}reflect(t){return t=u.fromVector(t).normalize(),this.subtract(t.scale(2*this.dot(t)))}mirror(t){return this.reflect(t).negate()}rotate(t){let i=Math.cos(t),e=Math.sin(t);return this.set(i*this.x-e*this.y,e*this.x+i*this.y)}toPolar(){return{p:Math.sqrt(this.x*this.x+this.y*this.y),q:Math.atan2(this.y,this.x)}}},n=u,f=class{constructor(t,i="#000",e=new n(300,150),s=1){this.particles=[],this.lines=[],this.deltas=[],this.gradient=null,this._dpiMultiplier=s,this._ctx=t,this._debug=!1,this._viewportSize=e,this.transparentBackground=!0,this._backgroundColor=i}set viewportSize(t){this._viewportSize=t}render(){this.transparentBackground?this._ctx.clearRect(0,0,this._viewportSize.x*this._dpiMultiplier,this._viewportSize.y*this._dpiMultiplier):this.gradient?(this._ctx.fillStyle=this.gradient,this._ctx.fillRect(0,0,this._viewportSize.x*this._dpiMultiplier,this._viewportSize.y*this._dpiMultiplier)):(this._ctx.fillStyle=this._backgroundColor,this._ctx.fillRect(0,0,this._viewportSize.x*this._dpiMultiplier,this._viewportSize.y*this._dpiMultiplier));let t=this.particles.filter(e=>Boolean(e.letter)),i=this.particles.filter(e=>!Boolean(e.letter));this._ctx.fillStyle="rgba(255,255,255,0.7)",this._ctx.font=`${30*this._dpiMultiplier}px monospace`;for(let e of t)this._ctx.fillText(e.letter,(e.position.x-8)*this._dpiMultiplier,(e.position.y+10)*this._dpiMultiplier);this._ctx.fillStyle="rgba(255,255,255,0.5)",this._ctx.beginPath();for(let e of i)this._ctx.moveTo(e.position.x*this._dpiMultiplier,e.position.y*this._dpiMultiplier),this._ctx.arc(e.position.x*this._dpiMultiplier,e.position.y*this._dpiMultiplier,e.radius*this._dpiMultiplier,0,Math.PI*2);this._ctx.fill(),this._ctx.lineWidth=1*this._dpiMultiplier;for(let e of this.lines)this._ctx.beginPath(),this._ctx.strokeStyle=`rgba(255,255,255,${e.alpha})`,this._ctx.moveTo(e.a.x*this._dpiMultiplier,e.a.y*this._dpiMultiplier),this._ctx.lineTo(e.b.x*this._dpiMultiplier,e.b.y*this._dpiMultiplier),this._ctx.stroke();this._debug&&this.drawPerformanceGraphic()}drawPerformanceGraphic(){var t;let i=(o,d,x)=>(o-d)/(x-d),e=this.deltas.filter(o=>Boolean(o)),s=Math.min(...e),r=Math.max(...e);this._ctx.font=`${16*this._dpiMultiplier}px monospace`,this._ctx.strokeStyle="#fff",this._ctx.fillStyle="#fff";let h=0,a=70;this._ctx.beginPath(),this._ctx.moveTo(h*this._dpiMultiplier,(a-this.deltas[0])*this._dpiMultiplier);for(let o of this.deltas){let d=a-50*i(o,s,r);this._ctx.lineTo(h*this._dpiMultiplier,d*this._dpiMultiplier),h+=1}this._ctx.moveTo(0,a*this._dpiMultiplier),this._ctx.lineTo(this.deltas.length*this._dpiMultiplier,a*this._dpiMultiplier),this._ctx.fillText(s,this.deltas.length*this._dpiMultiplier,(a+4)*this._dpiMultiplier),this._ctx.moveTo(0,(a-50)*this._dpiMultiplier),this._ctx.lineTo(this.deltas.length*this._dpiMultiplier,(a-50)*this._dpiMultiplier),this._ctx.fillText(r,this.deltas.length*this._dpiMultiplier,(a-50+4)*this._dpiMultiplier),this._ctx.closePath(),this._ctx.stroke(),this._ctx.fillText(`${this.particles.length.toString()} particles`,0,15*this._dpiMultiplier),this._ctx.fillText(`${(t=this.deltas[this.deltas.length-1])==null?void 0:t.toString()} ms`,130*this._dpiMultiplier,15*this._dpiMultiplier)}},M=f,m=class{constructor(){this.position=new n,this.velocity=new n,this.active=!0,this.letter,this.radius=1}update(){this.position.add(this.velocity)}},w=class{constructor(){this.particles=[]}createParticle(){let t=new m;return this.particles.push(t),t}},b=class{constructor(t=0,i=0,e=0,s=0){this.position=new n(t,i),this.size=new n(e,s)}get left(){return this.position.x}set left(t){t>=this.right?this.size.x=0:this.size.x=this.right-t,this.position.x=t}get right(){return this.position.x+this.size.x}set right(t){t<=this.position.x?this.size.x=0:this.size.x=t-this.position.x}get top(){return this.position.y}set top(t){t>=this.bottom?this.size.y=0:this.size.y=this.bottom-t,this.position.y=t}get bottom(){return this.position.y+this.size.y}set bottom(t){t<=this.position.y?this.size.y=0:this.size.y=t-this.position.y}get center(){return new n(this.position.x+this.size.x/2,this.position.y+this.size.y/2)}set center({x:t,y:i}){this.x=t-this.size.x/2,this.y=i-this.size.y/2}set(t,i,e,s){this.position.set(t,i),this.size.set(e,s)}contains(t){return t.x>=this.left&&t.x<=this.right&&t.y>=this.top&&t.y<=this.bottom}intersectsCircle(t){return!(t.position.x+t.radius<=this.left&&t.position.x+t.radius>=this.right&&t.position.y+t.radius<=this.top&&t.position.y+t.radius>=this.bottom)}},p=b,v=class{constructor(t=new n,i=new n){this.a=t,this.b=i}length(){return Math.sqrt((this.b.x-this.a.x)*(this.b.x-this.a.x)+(this.b.y-this.a.y)*(this.b.y-this.a.y))}},z=v,c=class{constructor(t,i){this.rectangle=t,this.capacity=i,this.points=[],this.divided=!1,this.northEast,this.northWest,this.southEast,this.southWest}subdivide(){let t=this.rectangle.position.x,i=this.rectangle.position.y,e=this.rectangle.size.x,s=this.rectangle.size.y,r=this.capacity;this.northEast=new c(new p(t,i,e/2,s/2),r),this.northWest=new c(new p(t+e/2,i,e/2,s/2),r),this.southEast=new c(new p(t,i+s/2,e/2,s/2),r),this.southWest=new c(new p(t+e/2,i+s/2,e/2,s/2),r),this.divided=!0}insert(t){var i;return this.rectangle.contains(t.position)?this.points.length<this.capacity?(this.points.push(t),!0):(this.divided||this.subdivide(),(i=this.northEast.insert(t)||this.northWest.insert(t)||this.southEast.insert(t)||this.southWest.insert(t))!=null?i:!1):!1}queryCircle(t){let i=[],e=[];e.push(this);for(let s=0;s<e.length;s++){let r=e[s];if(r.rectangle.intersectsCircle(t)){for(let h of r.points)t.intersectsPoint(h.position)&&i.push(h);r.divided&&(e.push(r.northEast),e.push(r.northWest),e.push(r.southEast),e.push(r.southWest))}}return i}},_=c,k=class{static intBetween(t,i){return i||(i=t,t=0),Math.floor(Math.random()*(i-t)+t)}static floatBetween(t,i){return i||(i=t,t=0),Math.random()*(i-t)+t}static fromArray(t){return t[Math.floor(Math.random()*t.length)]}static indexFromArray(t){return Math.floor(Math.random()*t.length)}},l=k,T=class{constructor(t){g(this,"oneFrame",this._update),this._canvas=t,this._ctx=this._canvas.getContext("2d"),this._particleManager=null,this._dpiMultiplier=null,this._renderer=null,this._boundUpdate=this._update.bind(this),this._isRunning=!1,this._ticks=0,this._deltas=new Array(200),this._debug=!1,this._boundary=null,this._quadtree=null,this._resizeTimeout=null}init(t){this._settings=t,this._particleManager=new w;for(let i=0;i<t.particles.amount;i++){let e=this._particleManager.createParticle();e.position.set(l.intBetween(-t.particles.distanceToLink,t.renderer.width+t.particles.distanceToLink),l.intBetween(-t.particles.distanceToLink,t.renderer.height+t.particles.distanceToLink));let s=new n,r=3,h=4;switch(t.particles.moveDirection){case"top":s.set(l.floatBetween(-t.particles.maxVelocity/r,t.particles.maxVelocity/r),l.floatBetween(-t.particles.maxVelocity,-t.particles.maxVelocity/h));break;case"right":s.set(l.floatBetween(t.particles.maxVelocity,t.particles.maxVelocity/h),l.floatBetween(-t.particles.maxVelocity/r,t.particles.maxVelocity/r));break;case"bottom":s.set(l.floatBetween(-t.particles.maxVelocity/r,t.particles.maxVelocity/r),l.floatBetween(t.particles.maxVelocity,t.particles.maxVelocity/h));break;case"left":s.set(l.floatBetween(-t.particles.maxVelocity,-t.particles.maxVelocity/h),l.floatBetween(-t.particles.maxVelocity/r,t.particles.maxVelocity/r));break;default:case"random":s.set(l.floatBetween(-t.particles.maxVelocity,t.particles.maxVelocity),l.floatBetween(-t.particles.maxVelocity,t.particles.maxVelocity));break}e.velocity=s,e.radius=l.floatBetween(0,t.particles.maxRadius)}if(t.staticParticles)for(let i of t.staticParticles){let e=this._particleManager.createParticle();e.active=!1,e.radius=0,e.position.set(t.renderer.width*i[0],t.renderer.height*i[1])}if(t.renderer.dpiMultiplier?this._dpiMultiplier=t.renderer.dpiMultiplier:this._dpiMultiplier=1,this._renderer=new M(this._ctx,t.renderer.backgroundColor,new n,this._dpiMultiplier),this._renderer.transparentBackground=t.renderer.transparentBackground,this._setSize(t.renderer.width,t.renderer.height),t.renderer.linearGradient){let i=this._ctx.createLinearGradient(t.renderer.width*t.renderer.linearGradient.x1*this._dpiMultiplier,t.renderer.height*t.renderer.linearGradient.y1*this._dpiMultiplier,t.renderer.width*t.renderer.linearGradient.x2*this._dpiMultiplier,t.renderer.height*t.renderer.linearGradient.y2*this._dpiMultiplier);i.addColorStop(0,t.renderer.linearGradient.color1),i.addColorStop(1,t.renderer.linearGradient.color2),this._renderer.gradient=i}return this.debug=t.debug,t.resize&&window.addEventListener("resize",this._onResize.bind(this)),this}_onResize(){this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(()=>this._setSize(window.innerWidth,window.innerHeight),100)}start(){return this._isRunning=!0,window.requestAnimationFrame(this._boundUpdate),console.info("Spark Partilces started!"),this}stop(){return this._isRunning=!1,this}_update(){let t=Date.now();this._quadtree=new _(this._boundary,4);let i=this._particleManager.particles.filter(h=>h.active);for(let h of i)h.update(),this._checkBoundary(h,this._boundary),this._quadtree.insert(h);let e=[];this._settings.particles.linkedParticles&&(e=this._linkPartiles(this._particleManager.particles,this._settings.particles.distanceToLink)),this._renderer.particles=this._particleManager.particles,this._renderer.lines=e,this._renderer.deltas=this._deltas,this._renderer.render(),this._isRunning&&window.requestAnimationFrame(this._boundUpdate),this._ticks++;let s=Date.now()-t;this._deltas.push(s),this._deltas.length>this._deltas.length-1&&this._deltas.shift();let r=this._deltas.filter(h=>h!==void 0);return this}_linkPartiles(t,i){let e=[];for(let s=0;s<t.length-1;s++)for(let r=s+1;r<t.length;r++){let h=t[s].position.distance(t[r].position);if(h<i){let a=new z(n.fromVector(t[s].position),n.fromVector(t[r].position)),o=1-h/i;a.alpha=o,e.push(a)}}return e}_setSize(t,i){return this._canvas.style.width=t.toString()+"px",this._canvas.style.height=i.toString()+"px",this._canvas.width=t*this._dpiMultiplier,this._canvas.height=i*this._dpiMultiplier,this._renderer.viewportSize=new n(t,i),this._boundary=new p(-this._settings.particles.distanceToLink,-this._settings.particles.distanceToLink,t+this._settings.particles.distanceToLink*2,i+this._settings.particles.distanceToLink*2),this._quadtree=new _(this._boundary,4),this}get debug(){return this._debug}set debug(t){this._debug=t,this._renderer._debug=t}_checkBoundary(t,i){if(t.position.x<i.left){t.position.x=i.right;return}if(t.position.x>i.right){t.position.x=i.left;return}if(t.position.y<i.top){t.position.y=i.bottom;return}t.position.y>i.bottom&&(t.position.y=i.top)}},S=T;export{S as default};
